<template>
    <div
        class="relative flex flex-col min-w-0 break-words w-full mb-6 rounded"
        style="background: #303030;"
        :class="[color === 'light' ? 'bg-white' : 'bg-emerald-900 text-white']"
    >

    <!-- <JSONCards/> -->
        <!-- <div class="accordion-container">
            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>What is Car-Connect?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            Car-Connect helps hundreds of people everyday to
                            sell their cars quickly and easily, by finding the
                            car dealer that’ll pay the most for your car.
                        </p>
                        <br />
                        <p>
                            Unlike your other options, we won’t make you choose
                            between price and convenience – you can have both,
                            with no extra effort. We’ll guide you through the
                            process to get a great result, and leave you feeling
                            like a pro.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Is it complicated?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            No. To complete the entire process, all we need you
                            to do is enter your reg, provide the details and
                            photos requested, accept your highest offer from our
                            verified dealer network, then arrange the collection
                            with the dealer at a time suitable for you.
                            Car-Connect handles everything else for you.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>What are the key steps?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            1. Get your instant Free Online valuation in
                            seconds.
                        </p>
                        <br />
                        <p>2. Book an appointment that suits you.</p>
                        <br />
                        <p>3. We'll buy your car in under an hour.</p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Can the online valuation change?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            We try to keep our online valuations as consistent
                            as possible, but if there are major shifts in the
                            market that affect your car’s value – up or down –
                            we’ll react to them to ensure the fairest price.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Is there a transaction fee?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            No. We pride ourselves on no hidden charges, and we
                            don’t charge a transaction fee.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Valuation is valid for how much time?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            you should refresh your valuation to make sure the
                            figure you’ve got is up to date.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Will online valuation offer change?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            All the cars we buy are subject to inspection and
                            the online valuations we issue are not contractual
                            offers, but we pride ourselves on our fair prices
                            and paying the online valuation figure as often as
                            possible. If, when we inspect the car we find faults
                            or damage that we weren’t aware of from the
                            information you supplied online, then the price
                            you’re offered at inspection may be different to
                            your online valuation. However, unlike other car
                            buyers, we won’t try to drive down your price by
                            penalising you for fair wear and tear or over-charge
                            you for inexpensive repairs.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>What does subject to inspection mean?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            Our online valuations are not contractual offers,
                            and any car we buy is subject to inspection, which
                            means that we need to see and check your car before
                            finalising our offer to buy it.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>Will the dealer collect my car?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            Once you have agreed the sale, the dealer will be in
                            touch within two working days to arrange collection.
                            You agree a time and date suitable to you both, and
                            the dealer (or their driver) will come to your home
                            or workplace to inspect and collect the vehicle. Our
                            sales support team will ensure that this happens in
                            a timely fashion, and are on hand to help with any
                            queries.
                        </p>
                    </div>
                </div>
            </div>

            <div class="ac">
                <h2 class="ac-header">
                    <button class="ac-trigger">
                        <p>What if my car doesn’t sell?</p>
                    </button>
                </h2>
                <div class="ac-panel">
                    <div class="ac-text">
                        <p>
                            While we manage price expectations as best we can,
                            sometimes cars do not sell on the first day with Car
                            Connect, this can be for a number of reasons,
                            including the current popularity of your make of car
                            or recent high volumes of a particular model in the
                            market at the time. On these occasions we will
                            discuss with you whether an adjusted price would
                            enable the car to sell to a verified dealer in our
                            network, or if an alternative approach is required.
                        </p>
                    </div>
                </div>
            </div>
        </div> -->

























        <div>
            <div class="accordion-container">
                <div class="ac">
                    <h2 class="ac-header">
                        <button class="ac-trigger">
                            <p>Clients</p>
                        </button>
                    </h2>
                    <div class="ac-panel">
                        <div class="ac-text">
                            <div id="APIClient"></div>
                            <!-- <div id="APIClientTable"></div> -->
                        </div>
                    </div>
                </div>

                <div class="ac">
                    <h2 class="ac-header">
                        <button class="ac-trigger">
                            <p>Contacts</p>
                        </button>
                    </h2>
                    <div class="ac-panel">
                        <div class="ac-text">
                            <div id="APIContact"></div>
                        </div>
                    </div>
                </div>

                <div class="ac">
                    <h2 class="ac-header">
                        <button class="ac-trigger">
                            <p>APIs</p>
                        </button>
                    </h2>
                    <div class="ac-panel">
                        <div class="ac-text">
                            <div>
                                <div>
                                    <br /><br /><br />
                                    <h3
                                        class="font-semibold text-lg text-blueGray-700"
                                        style="color:white;background-color:#505050;width:100%;"
                                    >
                                        FIRST API CALL - INITIAL DETAILS.
                                    </h3>
                                    <br />
                                    <div>
                                        <form
                                            action="/API1"
                                            method="post"
                                            @submit.prevent="API1"
                                        >
                                            <div
                                                style=" display: table; margin: 4px; padding: 1px;"
                                            >
                                                <div
                                                    style="display: table-cell;"
                                                >
                                                    <input
                                                        v-model="API1Input"
                                                        required
                                                        name="API1Input"
                                                        type="text"
                                                        class="border-0 px-3 py-3 placeholder-blueGray-300 text-blueGray-600 bg-white text-sm shadow focus:outline-none focus:ring w-full ease-linear transition-all duration-150"
                                                        id="API1Input"
                                                        style="margin: 1px;"
                                                        placeholder="e.g. AA19AAA"
                                                    />
                                                </div>
                                                <div class="ml-2">
                                                    <button
                                                        name="API1Button"
                                                        value="Car Details"
                                                        type="submit"
                                                        class="bg-blueGray-800 text-white active:bg-blueGray-600 text-sm font-bold uppercase px-6 py-3 shadow hover:shadow-lg outline-none focus:outline-none mr-1 ml-2 mb-1 ease-linear transition-all duration-150"
                                                        style="margin: 1px; background-color: #fdcc04;"
                                                    >
                                                        Initial Details
                                                    </button>
                                                </div>
                                            </div>
                                            <div>
                                                <div id="API1"></div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <br /><br /><br />

                                <div>
                                    <br /><br /><br />
                                    <h3
                                        class="font-semibold text-lg text-blueGray-700"
                                        style="color:white;background-color:#505050;width:100%;"
                                    >
                                        SECOND API CALL - CAR VALUE.
                                    </h3>
                                    <br />
                                    <div>
                                        <form
                                            action="/API2"
                                            method="post"
                                            @submit.prevent="API2"
                                        >
                                            <div
                                                style=" display: table; margin: 4px; padding: 1px;"
                                            >
                                                <div
                                                    style="display: table-cell;"
                                                >
                                                    <input
                                                        v-model="API2Input"
                                                        required
                                                        name="API2Input"
                                                        type="text"
                                                        class="border-0 px-3 py-3 placeholder-blueGray-300 text-blueGray-600 bg-white text-sm shadow focus:outline-none focus:ring w-full ease-linear transition-all duration-150"
                                                        id="API2Input"
                                                        style="margin: 1px;"
                                                        placeholder="e.g. AA19AAA"
                                                    />
                                                </div>
                                                <div class="ml-2">
                                                    <button
                                                        name="API2Button"
                                                        value="Car Valuation"
                                                        type="submit"
                                                        class="bg-blueGray-800 text-white active:bg-blueGray-600 text-sm font-bold uppercase px-6 py-3 shadow hover:shadow-lg outline-none focus:outline-none mr-1 ml-2 mb-1 ease-linear transition-all duration-150"
                                                        style="margin: 1px; background-color: #fdcc04;"
                                                    >
                                                        Car Value
                                                    </button>
                                                </div>
                                            </div>
                                            <div>
                                                <div id="API2"></div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <br /><br /><br />

                                <div>
                                    <br /><br /><br />
                                    <h3
                                        class="font-semibold text-lg text-blueGray-700"
                                        style="color:white;background-color:#505050;width:100%;"
                                    >
                                        THIRD API CALL - HPI CHECK.
                                    </h3>
                                    <br />
                                    <div>
                                        <form
                                            action="/API3"
                                            method="post"
                                            @submit.prevent="API3"
                                        >
                                            <div
                                                style=" display: table; margin: 4px; padding: 1px;"
                                            >
                                                <div
                                                    style="display: table-cell;"
                                                >
                                                    <input
                                                        v-model="API3Input"
                                                        required
                                                        name="API3Input"
                                                        type="text"
                                                        class="border-0 px-3 py-3 placeholder-blueGray-300 text-blueGray-600 bg-white text-sm shadow focus:outline-none focus:ring w-full ease-linear transition-all duration-150"
                                                        id="API3Input"
                                                        style="margin: 1px;"
                                                        placeholder="e.g. AA19AAA"
                                                    />
                                                </div>
                                                <div class="ml-2">
                                                    <button
                                                        name="API3Button"
                                                        value="Car Full VDI Check"
                                                        type="submit"
                                                        class="bg-blueGray-800 text-white active:bg-blueGray-600 text-sm font-bold uppercase px-6 py-3 shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ml-2 ease-linear transition-all duration-150"
                                                        style="margin: 1px; background-color: #fdcc04;"
                                                    >
                                                        HPI Check
                                                    </button>
                                                </div>
                                            </div>
                                            <div>
                                                <div id="API3"></div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <br /><br /><br />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    import bootstrap from "@/assets/bootstrap.jpg";
    import angular from "@/assets/angular.jpg";
    import sketch from "@/assets/sketch.jpg";
    import react from "@/assets/react.jpg";
    import vue from "@/assets/react.jpg";

    import team1 from "@/assets/team-1-800x800.jpg";
    import team2 from "@/assets/team-2-800x800.jpg";
    import team3 from "@/assets/team-3-800x800.jpg";
    import team4 from "@/assets/team-4-470x470.png";

    import { ref } from "vue";
    import firebase from "firebase";
    // import { onBeforeMount } from "vue";
    import { onMounted } from "vue";
    import axios from "axios";

    import JSONFormatter from "json-formatter-js";

    import Accordion from "accordion-js";
    import { Grid } from "gridjs";
    // import Jsontableify from "jsontableify";

    // import JSONCards from "@/components/JSONCards.vue";

    export default {
        setup() {
            var API1Input = ref();
            var API1Output = ref();
            var API2Input = ref();
            var API2Output = ref();
            var API3Input = ref();
            var API3Output = ref();

            var getData = () => {
                APIClient("APIClient", "CarID")
                    .then((res) => {
                        for (var i = 0; i < res.length; i++) {
                            res[i] = Object.keys(res[i])
                                .sort()
                                .reduce((obj, key) => {
                                    obj[key] = res[i][key];
                                    // console.log(obj);
                                    return obj;
                                }, {});
                        }
                        // JSONToHTMLTable(res, "APIClient");
                        // JSONData(res, "APIClient");
                        
                        // console.log(res);
                        // res = [{"CarDetails":"df","CarID":"1622698310783","CarMileage":"sdfs"},{"CarDetails":"vcbcv","CarID":"1622698277599","CarMileage":"cvbc"},{"CarDetails":"dsfs","CarID":"1622698249327","CarMileage":"dfs"}]
                        new Grid({
                            // columns: ["Name", "Email", "Phone Number"],
                            // data: [
                            // ["John", "john@example.com", "(353) 01 222 3333"],
                            // ["Mark", "mark@gmail.com", "(01) 22 888 4444"],
                            // ["Eoin", "eoin@gmail.com", "0097 22 654 00033"],
                            // ["Sarah", "sarahcdd@gmail.com", "+322 876 1233"],
                            // ["Afshin", "afshin@mail.com", "(353) 22 87 8356"]
                            // ],
                            data: res,
                            pagination: true,
                            search: true,
                            sort: true,
                            resizable: true,
                            // fixedHeader: true,
                            style: {
                            container:{
                                'color': '#ffffff !important',
                                'background-color': '#606060',
                                'border-radius': '0px'
                            },
                            table: {
                                // border: '3px solid #ccc'
                                color: '#ffffff',
                                'background-color': '#505050',
                                'border-radius': '0px'
                            },
                            header:{
                                'border-radius': '0px'
                            },
                            th: {
                                'background-color': '#606060',
                                color: '#ffffff',
                                'border-bottom': '3px solid #ccc',
                                'text-align': 'center',
                                'border-radius': '0px'
                            },
                            td: {
                                'text-align': 'center',
                                color: '#ffffff',
                                'background-color': '#505050',
                                'border-radius': '0px'
                            },
                            footer: {
                                // 'text-align': 'center',
                                'color': '#ffffff !important',
                                'background-color': '#606060',
                                'border-radius': '0px'
                            }
                            },
                        }).render(document.getElementById("APIClient"));
                        // console.log(document.getElementById("APIClient"));
                    })
                    .catch((e) => console.log(e));

                APIContact("APIContact", "ContactID")
                    .then((res) => {
                        for (var i = 0; i < res.length; i++) {
                            res[i] = Object.keys(res[i])
                                .sort()
                                .reduce((obj, key) => {
                                    obj[key] = res[i][key];
                                    return obj;
                                }, {});
                        }
                        // JSONToHTMLTable(res, "APIClient");
                        // JSONData(res, "APIContact");
                        // console.log(JSON.stringify(res));
                        // res = [{"ContactEmail":"a@b.com","ContactID":"1622706526600","ContactMessage":"d"},{"ContactEmail":"a@b.com","ContactID":"1622705891445","ContactMessage":"vxcv"}];
                        new Grid({
                            // columns: ["Name", "Email", "Phone Number"],
                            // data: [
                            // ["John", "john@example.com", "(353) 01 222 3333"],
                            // ["Mark", "mark@gmail.com", "(01) 22 888 4444"],
                            // ["Eoin", "eoin@gmail.com", "0097 22 654 00033"],
                            // ["Sarah", "sarahcdd@gmail.com", "+322 876 1233"],
                            // ["Afshin", "afshin@mail.com", "(353) 22 87 8356"]
                            // ],
                            data: res,
                            pagination: true,
                            search: true,
                            sort: true,
                            resizable: true,
                            // fixedHeader: true,
                            style: {
                            container:{
                                'color': '#ffffff !important',
                                'background-color': '#606060',
                                'border-radius': '0px'
                            },
                            table: {
                                // border: '3px solid #ccc'
                                color: '#ffffff',
                                'background-color': '#505050',
                                'border-radius': '0px'
                            },
                            header:{
                                'border-radius': '0px'
                            },
                            th: {
                                'background-color': '#606060',
                                color: '#ffffff',
                                'border-bottom': '3px solid #ccc',
                                'text-align': 'center',
                                'border-radius': '0px'
                            },
                            td: {
                                'text-align': 'center',
                                color: '#ffffff',
                                'background-color': '#505050',
                                'border-radius': '0px'
                            },
                            footer: {
                                // 'text-align': 'center',
                                'color': '#ffffff !important',
                                'background-color': '#606060',
                                'border-radius': '0px'
                            }
                            },
                        }).render(document.getElementById("APIContact"));
                    })
                    .catch((e) => console.log(e));
            };

            var JSONData = (data, holder) => {
                const formatter = new JSONFormatter(data, 1, { theme: "dark" });
                var divContainer = document.getElementById(holder);
                divContainer.innerHTML = "";
                divContainer.appendChild(formatter.render());
            };


            // function JSONToHTMLTable(jsonData, elementToBind) {
            //   //This Code gets all columns for header   and stored in array col
            //   var col = [];
            //   for (var i = 0; i < jsonData.length; i++) {
            //       for (var key in jsonData[i]) {
            //           if (col.indexOf(key) === -1) {
            //               col.push(key);
            //           }
            //       }
            //   }

            //   //This Code creates HTML table
            //   var table = document.createElement("table");
            //   table.style.color = "grey";

            //   //This Code getsrows for header creader above.
            //   var tr = table.insertRow(-1);

            //   for (var p  = 0; p < col.length; p++) {
            //       var th = document.createElement("th");
            //       th.innerHTML = col[p];
            //       tr.appendChild(th);
            //   }

            //   //This Code adds data to table as rows
            //   for (var q = 0; q < jsonData.length; q++) {

            //       tr = table.insertRow(-1);

            //       for (var r = 0; r < col.length; r++) {
            //           var tabCell = tr.insertCell(-1);
            //           tabCell.innerHTML = jsonData[q][col[r]];
            //       }
            //   }

            //   //This Code gets the all columns for header
            //   var divContainer = document.getElementById(elementToBind);
            //   divContainer.innerHTML = "";
            //   divContainer.appendChild(table);
            // }

            var APIClient = (collection, orderField) => {
                return new Promise((res, rej) => {
                    firebase
                        .firestore()
                        .collection(collection)
                        .orderBy(orderField, "desc")
                        .limit(100)
                        .get()
                        .then((snapshot) => {
                            console.log("Client Data fetched from Firestore.");
                            var data = snapshot.docs.map((doc) => doc.data());

                            res(data);
                        })
                        .catch((e) => {
                            console.log(e);
                            rej(e);
                        });
                });
            };

            var APIContact = (collection, orderField) => {
                return new Promise((res, rej) => {
                    firebase
                        .firestore()
                        .collection(collection)
                        .orderBy(orderField, "desc")
                        .limit(100)
                        .get()
                        .then((snapshot) => {
                            console.log("Contact Data fetched from Firestore.");
                            var data = snapshot.docs.map((doc) => doc.data());

                            res(data);
                        })
                        .catch((e) => {
                            console.log(e);
                            rej(e);
                        });
                });
            };

            var API1 = async () => {
                await firebase
                    .firestore()
                    .collection("API1")
                    .where("registrationNumber", "==", API1Input.value)
                    .limit(1)
                    .get()
                    .then((snapshot) => {
                        console.log("API1 Data fetched from Firestore.");
                        var data = snapshot.docs.map((doc) => doc.data());
                        JSONData(data, "API1");
                        // var html = new Jsontableify({
                        //     }).toHtml(data);
                        // console.log(data);
                        // console.log(html);
                        // var divContainer = document.getElementById("API1");
                        // divContainer.innerHTML = "";
                        // divContainer.appendChild(html);

                    })
                    .catch((e) => {
                        console.log(e);
                    });
            };

            var API2 = async () => {
                // var match = JSON.parse(`{Vrm: ${API2Input.value}}`);
                // console.log(match);
                // var db = firebase.firestore();
                // db.collection('API2').where("API2Input.value", "array-contains", match).get().then(snapshot => {
                //     const data = snapshot.val();
                //     data.forEach(doc => {
                //       if (doc.exists) {
                //         console.log("exist");
                //       } else {
                //         console.log("not exist");
                //       }
                //     });
                //   })
                //   .catch(error => {
                //     console.log(error);
                //   });

                var URL =
                    "https://uk1.ukvehicledata.co.uk/api/datapackage/ValuationData?v=2&api_nullitems=1&auth_apikey=87715f2c-f6a3-4f77-8527-94511f3ee5a4&key_VRM=" +
                    API2Input.value;
                await axios
                    .get(URL)
                    .then((response) => {
                        API2Output.value = response.data;
                        JSONData(API2Output.value, "API2");
                        const db = firebase.firestore();
                        db.collection("API2")
                            .add(API2Output.value)
                            .then(
                                console.log("API2 Data entered into Firestore.")
                            )
                            .catch((e) => console.log(e));
                    })
                    .catch((e) => console.log(e));
            };

            var API3 = async () => {
                var URL =
                    "https://uk1.ukvehicledata.co.uk/api/datapackage/VdiCheckFull?v=2&api_nullitems=1&auth_apikey=87715f2c-f6a3-4f77-8527-94511f3ee5a4&key_VRM=" +
                    API3Input.value;
                await axios
                    .get(URL)
                    .then((response) => {
                        API3Output.value = response.data;
                        JSONData(API3Output.value, "API3");
                        const db = firebase.firestore();
                        db.collection("API3")
                            .add(API3Output.value)
                            .then(
                                console.log("API3 Data entered into Firestore.")
                            )
                            .catch((e) => console.log(e));
                    })
                    .catch((e) => console.log(e));
            };

            // var getContactus = async  () => {
            // await firebase
            //         .firestore()
            //         .collection('contactus')
            //         .orderBy('Date Created','desc')
            //         .get()
            //         .then(snapshot => {
            //           contactus.value = snapshot.docs.map(doc => doc.data());
            //           console.log(contactus.value);
            //           JSONToHTMLTable(contactus.value, "contactus");
            //         }
            //         )

            // // console.log(contactus.value);
            // return contactus.value;
            // }

            onMounted(() => {
              new Accordion(".accordion-container");
              getData();
            });

            // onBeforeMount(() => {
            //     // getData();
            //     // new Accordion(".accordion-container");
            // });

            return {
                APIClient,
                APIContact,
                API1,
                API1Input,
                API1Output,
                API2,
                API2Input,
                API2Output,
                API3,
                API3Input,
                API3Output,
                getData,
                JSONData,
                // JSONToGrid,
            };
        },

        data() {
            return {
                bootstrap,
                angular,
                sketch,
                react,
                vue,
                team1,
                team2,
                team3,
                team4,
            };
        },
        components: {
            // JSONCards,
        },
        props: {
            color: {
                default: "light",
                validator: function(value) {
                    return ["light", "dark"].indexOf(value) !== -1;
                },
            },
        },
    };
</script>

<style scoped>
    .th-90 {
        background-color: #000;
        color: #fff;
    }
    .th-90,
    .td-90 {
        padding: 10px;
    }

    .tr-90:nth-child(odd) {
        background-color: #f2f2f2;
    }

    .json-formatter-dark {
        background-color: #ff0000 !important;
    }

    @import "accordion-js/dist/accordion.min.css";

    .ac {
        margin: 0px;
        border: 0px;
        color: white !important;
    }

    .ac-trigger {
        background: #707070;
        color: white !important;
    }

    .ac-panel {
        background: #202020;
        color: white !important;
    }

    .ac-text {
        background: #404040;
        color: white !important;
    }

    .gridjs-pagination{
        color : #ffffff !important;
    }



    @import "gridjs/dist/theme/mermaid.css";
</style>
